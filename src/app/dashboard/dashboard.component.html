import { Component, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterLink } from '@angular/router';
import { Firestore, collection, collectionData, query, orderBy, limit } from '@angular/fire/firestore';
import { Observable } from 'rxjs';

@Component({
selector: 'app-dashboard',
standalone: true,
imports: [CommonModule, RouterLink],
// âœ… YOUR EXACT HTML (Inline to fix build errors)
template: `
<div class="dashboard-container p-4">
  <header class="mb-4">
    <h1 class="text-white font-orbitron text-3xl">Obrioxia Analytics</h1>
    <p class="text-gray-400">System Monitor v4.0</p>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
    <div class="p-3 bg-white/5 border border-white/10 rounded-xl">
      <h5 class="text-gray-400 text-sm">Total Requests</h5>
      <h2 class="text-4xl font-bold text-white">1,204</h2>
    </div>
    <div class="p-3 bg-white/5 border border-white/10 rounded-xl">
      <h5 class="text-gray-400 text-sm">Incidents</h5>
      <h2 class="text-4xl font-bold text-red-500">0</h2>
    </div>
    <div class="p-3 bg-white/5 border border-white/10 rounded-xl">
      <h5 class="text-gray-400 text-sm">Chain Integrity</h5>
      <h2 class="text-4xl font-bold text-green-500">100%</h2>
    </div>
    <div class="p-3 bg-white/5 border border-white/10 rounded-xl">
      <h5 class="text-gray-400 text-sm">Shredded Events</h5>
      <h2 class="text-4xl font-bold text-gray-500">12</h2>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <div class="col-span-2 bg-white/5 border border-white/10 rounded-xl p-3 mb-4">
      <h4 class="text-white font-orbitron mb-4">Request Timeline</h4>
      <div style="display: block; height: 200px;"
        class="flex items-center justify-center border border-white/5 rounded bg-black/20">
        <span class="text-gray-500 font-mono animate-pulse">Initializing Data Stream...</span>
      </div>
    </div>

    <div class="bg-white/5 border border-white/10 rounded-xl p-3">
      <h4 class="text-white font-orbitron mb-4">Recent Decisions</h4>
      <ul class="space-y-2">
        <li class="p-2 border-b border-white/5 flex justify-between items-center" *ngFor="let log of logs$ | async">
          <small class="text-gray-500 font-mono">{{ log.timestamp ? (log.timestamp | date:'shortTime') : 'Now'
            }}</small>
          <div class="text-right">
            <strong class="text-obrioxia-cyan text-sm block">ID: {{ log.decision_id ? (log.decision_id | slice:0:8) :
              'Pending' }}...</strong>
            <span *ngIf="log._is_encrypted" class="text-[10px] bg-gray-700 text-gray-300 px-1 rounded">Encrypted</span>
          </div>
        </li>

        <li *ngIf="(logs$ | async)?.length === 0" class="text-center text-gray-500 py-4">
          No recent events found.
        </li>
      </ul>
    </div>
  </div>
</div>
`
})
export class DashboardComponent {
private firestore = inject(Firestore);

logs$: Observable<any[]>;

  constructor() {
  // Safe Data Fetching
  const logsCollection = collection(this.firestore, 'audit_logs');
  const q = query(logsCollection, orderBy('timestamp', 'desc'), limit(10));
  this.logs$ = collectionData(q, { idField: 'id' });
  }
  }