<div class="min-h-screen bg-obrioxia-base pt-28 pb-20 px-4">
  <div class="max-w-7xl mx-auto">
    
    <div class="mb-8 flex justify-between items-end">
      <div>
        <button (click)="goBack()" class="text-obrioxia-cyan text-sm font-orbitron hover:underline mb-2">&larr; BACK TO HUB</button>
        <h1 class="text-3xl text-white font-orbitron">Decision <span class="text-obrioxia-cyan">Intelligence</span></h1>
        <p class="text-gray-400 mt-2">Real-time forensic analysis of AI confidence and integrity.</p>
      </div>
      <div *ngIf="kpi" class="flex items-center gap-2">
        <div class="w-2 h-2 rounded-full" [class.bg-green-500]="kpi.status === 'Healthy'" [class.bg-red-500]="kpi.status === 'Risk'"></div>
        <span class="text-xs font-mono text-gray-400">SYSTEM STATUS: {{ kpi.status | uppercase }}</span>
      </div>
    </div>

    <div *ngIf="loading()" class="text-center py-20 text-gray-500 animate-pulse">
      ANALYZING LEDGER DATA...
    </div>

    <div [class.hidden]="loading()">
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="glass-panel p-6 rounded-xl border border-white/10">
          <h4 class="text-gray-500 text-xs font-orbitron mb-2">24H CONFIDENCE</h4>
          <div class="text-4xl text-white font-mono">{{ kpi?.average_confidence || '0.00' }}</div>
          <div class="text-xs mt-2" [ngClass]="(kpi?.average_confidence > 0.8) ? 'text-green-400' : 'text-red-400'">
            {{ (kpi?.average_confidence > 0.8) ? '● Optimal Performance' : '● Model Drift Detected' }}
          </div>
        </div>

        <div class="glass-panel p-6 rounded-xl border border-white/10">
          <h4 class="text-gray-500 text-xs font-orbitron mb-2">TOTAL DECISIONS</h4>
          <div class="text-4xl text-white font-mono">{{ kpi?.total_decisions || 0 }}</div>
          <p class="text-xs text-gray-500 mt-2">Immutable Records Sealed</p>
        </div>

        <div class="glass-panel p-6 rounded-xl border border-white/10">
          <h4 class="text-gray-500 text-xs font-orbitron mb-2">ANOMALIES DETECTED</h4>
          <div class="text-4xl text-white font-mono">{{ kpi?.anomaly_count || 0 }}</div>
          <p class="text-xs text-gray-500 mt-2">Confidence < 0.70</p>
        </div>
      </div>

      <div class="glass-panel p-6 rounded-xl border border-white/10 mb-8">
        <h3 class="text-white font-orbitron text-sm mb-4">Decision Confidence Trend (7 Days)</h3>
        <div class="relative h-80 w-full">
          <canvas #trendChart></canvas>
        </div>
      </div>

      <div class="glass-panel rounded-xl border border-white/10 overflow-hidden">
        <div class="p-6 border-b border-white/5 flex justify-between items-center">
          <h3 class="text-white font-orbitron text-sm">Recent Anomalies & Risks</h3>
          <span class="text-xs text-red-400 border border-red-500/30 px-2 py-1 rounded bg-red-500/10">Attention Required</span>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-left text-sm text-gray-400">
            <thead class="bg-white/5 text-xs uppercase font-orbitron text-gray-300">
              <tr>
                <th class="p-4">Timestamp</th>
                <th class="p-4">Agent ID</th>
                <th class="p-4">Confidence</th>
                <th class="p-4">Integrity Hash</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-white/5">
              <tr *ngFor="let row of anomalies" class="hover:bg-white/5 transition-colors">
                <td class="p-4 font-mono text-xs">{{ row.timestamp }}</td>
                <td class="p-4">{{ row.agent }}</td>
                <td class="p-4 text-red-400 font-bold">{{ row.confidence }}</td>
                <td class="p-4 font-mono text-xs truncate max-w-[150px] text-gray-600">{{ row.hash }}...</td>
              </tr>
              <tr *ngIf="anomalies.length === 0">
                <td colspan="4" class="p-8 text-center text-gray-500">No anomalies detected in recent logs.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>
